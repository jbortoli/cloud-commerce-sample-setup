{"version":3,"file":"node_modules_spartacus_tracking_fesm2020_spartacus-tracking-personalization_mjs.js","mappings":"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","sources":["./node_modules/@spartacus/tracking/fesm2020/spartacus-tracking-personalization-core.mjs","./node_modules/@spartacus/tracking/fesm2020/spartacus-tracking-personalization.mjs"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { NgModule, inject, isDevMode, Injectable } from '@angular/core';\nimport * as i2 from '@spartacus/core';\nimport { LoggerService } from '@spartacus/core';\nimport { EMPTY } from 'rxjs';\nimport { filter, map } from 'rxjs/operators';\nimport * as i1 from '@spartacus/tracking/personalization/root';\n\n/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass PersonalizationCoreModule {\n}\nPersonalizationCoreModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationCoreModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\nPersonalizationCoreModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"14.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationCoreModule });\nPersonalizationCoreModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationCoreModule });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationCoreModule, decorators: [{\n            type: NgModule,\n            args: [{}]\n        }] });\n\n/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass PersonalizationContextService {\n    constructor(config, cmsService) {\n        this.config = config;\n        this.cmsService = cmsService;\n        this.logger = inject(LoggerService);\n    }\n    getPersonalizationContext() {\n        if (!this.config.personalization?.context) {\n            if (isDevMode()) {\n                this.logger.warn(`There is no context configured in Personalization.`);\n            }\n            return EMPTY;\n        }\n        else {\n            const context = this.config.personalization.context;\n            return this.cmsService.getCurrentPage().pipe(filter(Boolean), map((page) => page.slots?.[context.slotPosition]), filter(Boolean), map((slot) => {\n                const scriptComponent = slot.components?.find((i) => i.uid === context.componentId);\n                return this.buildPersonalizationContext(scriptComponent?.properties?.script?.data);\n            }));\n        }\n    }\n    buildPersonalizationContext(data) {\n        if (data) {\n            const context = JSON.parse(atob(data));\n            context.actions.forEach((action) => {\n                Object.keys(action).forEach((key) => {\n                    action[key] = atob(action[key]);\n                });\n            });\n            for (let i = 0; i < context.segments.length; i++) {\n                context.segments[i] = atob(context.segments[i]);\n            }\n            return context;\n        }\n    }\n}\nPersonalizationContextService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationContextService, deps: [{ token: i1.PersonalizationConfig }, { token: i2.CmsService }], target: i0.ɵɵFactoryTarget.Injectable });\nPersonalizationContextService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationContextService, providedIn: 'root' });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationContextService, decorators: [{\n            type: Injectable,\n            args: [{\n                    providedIn: 'root',\n                }]\n        }], ctorParameters: function () { return [{ type: i1.PersonalizationConfig }, { type: i2.CmsService }]; } });\n\n/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { PersonalizationContextService, PersonalizationCoreModule };\n","import * as i0 from '@angular/core';\nimport { NgModule } from '@angular/core';\nimport { PersonalizationCoreModule } from '@spartacus/tracking/personalization/core';\n\n/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass PersonalizationModule {\n}\nPersonalizationModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\nPersonalizationModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"14.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationModule, imports: [PersonalizationCoreModule] });\nPersonalizationModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationModule, imports: [PersonalizationCoreModule] });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"15.2.4\", ngImport: i0, type: PersonalizationModule, decorators: [{\n            type: NgModule,\n            args: [{\n                    imports: [PersonalizationCoreModule],\n                }]\n        }] });\n\n/*\n * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { PersonalizationModule };\n"],"names":["i0","NgModule","inject","isDevMode","Injectable","i2","LoggerService","EMPTY","filter","map","i1","PersonalizationCoreModule","ɵfac","ɵmod","ɵinj","type","args","PersonalizationContextService","constructor","config","cmsService","logger","getPersonalizationContext","personalization","context","warn","getCurrentPage","pipe","Boolean","page","slots","slotPosition","slot","scriptComponent","components","find","i","uid","componentId","buildPersonalizationContext","properties","script","data","JSON","parse","atob","actions","forEach","action","Object","keys","key","segments","length","PersonalizationConfig","CmsService","ɵprov","providedIn","PersonalizationModule","imports"],"sourceRoot":"webpack:///","x_google_ignoreList":[0,1]}