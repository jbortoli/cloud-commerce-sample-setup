"use strict";
(self["webpackChunkmystore_6_3"] = self["webpackChunkmystore_6_3"] || []).push([["node_modules_spartacus_tracking_fesm2020_spartacus-tracking-personalization_mjs"],{

/***/ 639:
/*!***********************************************************************************************!*\
  !*** ./node_modules/@spartacus/tracking/fesm2020/spartacus-tracking-personalization-core.mjs ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "PersonalizationContextService": () => (/* binding */ PersonalizationContextService),
/* harmony export */   "PersonalizationCoreModule": () => (/* binding */ PersonalizationCoreModule)
/* harmony export */ });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ 2560);
/* harmony import */ var _spartacus_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @spartacus/core */ 6458);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs */ 6439);
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! rxjs/operators */ 9151);
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! rxjs/operators */ 6942);
/* harmony import */ var _spartacus_tracking_personalization_root__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @spartacus/tracking/personalization/root */ 3000);








/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
class PersonalizationCoreModule {}
PersonalizationCoreModule.ɵfac = function PersonalizationCoreModule_Factory(t) {
  return new (t || PersonalizationCoreModule)();
};
PersonalizationCoreModule.ɵmod = /* @__PURE__ */_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineNgModule"]({
  type: PersonalizationCoreModule
});
PersonalizationCoreModule.ɵinj = /* @__PURE__ */_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineInjector"]({});
(function () {
  (typeof ngDevMode === "undefined" || ngDevMode) && _angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](PersonalizationCoreModule, [{
    type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.NgModule,
    args: [{}]
  }], null, null);
})();

/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
class PersonalizationContextService {
  constructor(config, cmsService) {
    this.config = config;
    this.cmsService = cmsService;
    this.logger = (0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.inject)(_spartacus_core__WEBPACK_IMPORTED_MODULE_1__.LoggerService);
  }
  getPersonalizationContext() {
    if (!this.config.personalization?.context) {
      if ((0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.isDevMode)()) {
        this.logger.warn(`There is no context configured in Personalization.`);
      }
      return rxjs__WEBPACK_IMPORTED_MODULE_2__.EMPTY;
    } else {
      const context = this.config.personalization.context;
      return this.cmsService.getCurrentPage().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_3__.filter)(Boolean), (0,rxjs_operators__WEBPACK_IMPORTED_MODULE_4__.map)(page => page.slots?.[context.slotPosition]), (0,rxjs_operators__WEBPACK_IMPORTED_MODULE_3__.filter)(Boolean), (0,rxjs_operators__WEBPACK_IMPORTED_MODULE_4__.map)(slot => {
        const scriptComponent = slot.components?.find(i => i.uid === context.componentId);
        return this.buildPersonalizationContext(scriptComponent?.properties?.script?.data);
      }));
    }
  }
  buildPersonalizationContext(data) {
    if (data) {
      const context = JSON.parse(atob(data));
      context.actions.forEach(action => {
        Object.keys(action).forEach(key => {
          action[key] = atob(action[key]);
        });
      });
      for (let i = 0; i < context.segments.length; i++) {
        context.segments[i] = atob(context.segments[i]);
      }
      return context;
    }
  }
}
PersonalizationContextService.ɵfac = function PersonalizationContextService_Factory(t) {
  return new (t || PersonalizationContextService)(_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵinject"](_spartacus_tracking_personalization_root__WEBPACK_IMPORTED_MODULE_5__.PersonalizationConfig), _angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵinject"](_spartacus_core__WEBPACK_IMPORTED_MODULE_1__.CmsService));
};
PersonalizationContextService.ɵprov = /* @__PURE__ */_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineInjectable"]({
  token: PersonalizationContextService,
  factory: PersonalizationContextService.ɵfac,
  providedIn: 'root'
});
(function () {
  (typeof ngDevMode === "undefined" || ngDevMode) && _angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](PersonalizationContextService, [{
    type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.Injectable,
    args: [{
      providedIn: 'root'
    }]
  }], function () {
    return [{
      type: _spartacus_tracking_personalization_root__WEBPACK_IMPORTED_MODULE_5__.PersonalizationConfig
    }, {
      type: _spartacus_core__WEBPACK_IMPORTED_MODULE_1__.CmsService
    }];
  }, null);
})();

/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/**
 * Generated bundle index. Do not edit.
 */



/***/ }),

/***/ 911:
/*!******************************************************************************************!*\
  !*** ./node_modules/@spartacus/tracking/fesm2020/spartacus-tracking-personalization.mjs ***!
  \******************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "PersonalizationModule": () => (/* binding */ PersonalizationModule)
/* harmony export */ });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ 2560);
/* harmony import */ var _spartacus_tracking_personalization_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @spartacus/tracking/personalization/core */ 639);




/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
class PersonalizationModule {}
PersonalizationModule.ɵfac = function PersonalizationModule_Factory(t) {
  return new (t || PersonalizationModule)();
};
PersonalizationModule.ɵmod = /* @__PURE__ */_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineNgModule"]({
  type: PersonalizationModule
});
PersonalizationModule.ɵinj = /* @__PURE__ */_angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵɵdefineInjector"]({
  imports: [_spartacus_tracking_personalization_core__WEBPACK_IMPORTED_MODULE_1__.PersonalizationCoreModule]
});
(function () {
  (typeof ngDevMode === "undefined" || ngDevMode) && _angular_core__WEBPACK_IMPORTED_MODULE_0__["ɵsetClassMetadata"](PersonalizationModule, [{
    type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.NgModule,
    args: [{
      imports: [_spartacus_tracking_personalization_core__WEBPACK_IMPORTED_MODULE_1__.PersonalizationCoreModule]
    }]
  }], null, null);
})();

/*
 * SPDX-FileCopyrightText: 2023 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/**
 * Generated bundle index. Do not edit.
 */



/***/ })

}]);
//# sourceMappingURL=node_modules_spartacus_tracking_fesm2020_spartacus-tracking-personalization_mjs.js.map