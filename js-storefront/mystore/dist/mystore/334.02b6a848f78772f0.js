"use strict";(self.webpackChunkmystore_6_3=self.webpackChunkmystore_6_3||[]).push([[334],{5229:(xe,tt,h)=>{h.d(tt,{D:()=>n});var c=h(1177);function n(u){return I=>I.lift(new l(u))}class l{constructor(I){this.durationSelector=I}call(I,g){return g.subscribe(new d(I,this.durationSelector))}}class d extends c.Ds{constructor(I,g){super(I),this.durationSelector=g,this.hasValue=!1}_next(I){try{const g=this.durationSelector.call(this,I);g&&this._tryNext(I,g)}catch(g){this.destination.error(g)}}_complete(){this.emitValue(),this.destination.complete()}_tryNext(I,g){let y=this.durationSubscription;this.value=I,this.hasValue=!0,y&&(y.unsubscribe(),this.remove(y)),y=(0,c.ft)(g,new c.IY(this)),y&&!y.closed&&this.add(this.durationSubscription=y)}notifyNext(){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){if(this.hasValue){const I=this.value,g=this.durationSubscription;g&&(this.durationSubscription=void 0,g.unsubscribe(),this.remove(g)),this.value=void 0,this.hasValue=!1,super._next(I)}}}},4334:(xe,tt,h)=>{h.d(tt,{YA:()=>Ur,$:()=>Je,YW:()=>Re,Jp:()=>Dr,r_:()=>be,CQ:()=>Mt,vI:()=>ue,n5:()=>Me,i4:()=>Vr,Eu:()=>he,N4:()=>v,F5:()=>pr,Qx:()=>_r,T6:()=>U,xb:()=>b,F7:()=>Tt});var c=h(4650),n=h(8849),l=h(5359),d=h(3749),u=h(4850),I=h(1406),g=h(7221),y=h(1709),we=h(4002),S=h(7545),f=h(7168),E=h(2198),m=h(5778),L=h(2994),A=h(2986),Dt=h(5154),$e=h(519),Ne=h(5229),F=h(5254),M=h(1086),et=h(2654),ke=h(5409),k=h(6053),Ye=h(839),Be=h(8723),ze=h(8896),C=h(5024),He=h(9144),We=h(6538),je=h(6895),Qe=h(5391);const v="[Multi Cart] Multi Cart Data",V="addVoucher",Y="[Cart-entry] Add Entry",w="[Cart-entry] Add Entry Success",B="[Cart-entry] Add Entry Fail",rt="[Cart-entry] Remove Entry",z="[Cart-entry] Remove Entry Success",st="[Cart-entry] Remove Entry Fail",it="[Cart-entry] Update Entry",H="[Cart-entry] Update Entry Success",at="[Cart-entry] Update Entry Fail";class nt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=Y}}class ct extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=w}}class ot extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=B}}class Vt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=rt}}class _t extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=z}}class Lt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=st}}class Pt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=it}}class Gt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=H}}class bt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=at}}const O="[Cart-voucher] Add Cart Vouchers",dt="[Cart-voucher] Add Cart Voucher Fail",W="[Cart-voucher] Add Cart Voucher Success",xt="[Cart-voucher] Reset Add Cart Voucher",j="[Cart-voucher] Remove Cart Voucher",ut="[Cart-voucher] Remove Cart Voucher Fail",Q="[Cart-voucher] Remove Cart Voucher Success";class wt extends n.kPG.EntityLoadAction{constructor(s){super(n.BzF,V),this.payload=s,this.type=O}}class Ot extends n.kPG.EntityFailAction{constructor(s){super(n.BzF,V,s.error),this.payload=s,this.type=dt}}class $t extends n.kPG.EntitySuccessAction{constructor(s){super(n.BzF,V),this.payload=s,this.type=W}}class Nt extends n.kPG.EntityLoaderResetAction{constructor(){super(n.BzF,V),this.type=xt}}class kt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=j}}class Yt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=ut}}class Bt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=Q}}const P="[Cart] Create Cart",Ct="[Cart] Create Cart Fail",G="[Cart] Create Cart Success",$="[Cart] Load Cart",zt="[Cart] Load Cart Fail",_="[Cart] Load Cart Success",ht="[Cart] Load Carts Success",lt="[Cart] Add Email to Cart",Ht="[Cart] Add Email to Cart Fail",Wt="[Cart] Add Email to Cart Success",vt="[Cart] Merge Cart",pt="[Cart] Merge Cart Success",jt="[Cart] Reset Cart Details",Et="[Cart] Remove Cart",X="[Cart] Delete Cart",K="[Cart] Delete Cart Success",gt="[Cart] Delete Cart Fail";class St extends n.kPG.EntityLoadAction{constructor(s){super(v,s.tempCartId),this.payload=s,this.type=P}}class Qt extends n.kPG.EntityFailAction{constructor(s){super(v,s.tempCartId),this.payload=s,this.type=Ct}}class Xt extends n.kPG.EntitySuccessAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=G}}class Kt extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=lt}}class Jt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=Ht}}class qt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=Wt}}class R extends n.kPG.EntityLoadAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=$}}class It extends n.kPG.EntityFailAction{constructor(s){super(v,s.cartId,s.error),this.payload=s,this.type=zt}}class Zt extends n.kPG.EntitySuccessAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=_}}class te{constructor(s){this.payload=s,this.type=vt}}class ee extends n.kPG.EntityRemoveAction{constructor(s){super(v,s.oldCartId),this.payload=s,this.type=pt}}class re extends n.kPG.ProcessesLoaderResetAction{constructor(){super(v),this.type=jt}}class N extends n.kPG.EntityRemoveAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=Et}}class se{constructor(s){this.payload=s,this.type=X}}class ie extends n.kPG.EntityRemoveAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=K}}class ae{constructor(s){this.payload=s,this.type=gt}}const ne="[Cart] Cart Processes Increment",ce="[Cart] Cart Processes Decrement",J="[Cart] Set Active Cart Id",ft="[Cart] Clear Cart State",yt="[Cart] Set cart type index",At="[Cart] Set cart data";class oe extends n.kPG.EntityProcessesIncrementAction{constructor(s){super(v,s),this.payload=s,this.type=ne}}class Rt extends n.kPG.EntityProcessesDecrementAction{constructor(s){super(v,s),this.payload=s,this.type=ce}}class mt{constructor(s){this.payload=s,this.type=J}}class de extends n.kPG.EntityRemoveAllAction{constructor(){super(v),this.type=ft}}class D{constructor(s){this.payload=s,this.type=yt}}var Je=Object.freeze({__proto__:null,ADD_EMAIL_TO_CART:lt,ADD_EMAIL_TO_CART_FAIL:Ht,ADD_EMAIL_TO_CART_SUCCESS:Wt,AddEmailToCart:Kt,AddEmailToCartFail:Jt,AddEmailToCartSuccess:qt,CART_ADD_ENTRY:Y,CART_ADD_ENTRY_FAIL:B,CART_ADD_ENTRY_SUCCESS:w,CART_ADD_VOUCHER:O,CART_ADD_VOUCHER_FAIL:dt,CART_ADD_VOUCHER_SUCCESS:W,CART_PROCESSES_DECREMENT:ce,CART_PROCESSES_INCREMENT:ne,CART_REMOVE_ENTRY:rt,CART_REMOVE_ENTRY_FAIL:st,CART_REMOVE_ENTRY_SUCCESS:z,CART_REMOVE_VOUCHER:j,CART_REMOVE_VOUCHER_FAIL:ut,CART_REMOVE_VOUCHER_SUCCESS:Q,CART_RESET_ADD_VOUCHER:xt,CART_UPDATE_ENTRY:it,CART_UPDATE_ENTRY_FAIL:at,CART_UPDATE_ENTRY_SUCCESS:H,CLEAR_CART_STATE:ft,CREATE_CART:P,CREATE_CART_FAIL:Ct,CREATE_CART_SUCCESS:G,CartAddEntry:nt,CartAddEntryFail:ot,CartAddEntrySuccess:ct,CartAddVoucher:wt,CartAddVoucherFail:Ot,CartAddVoucherSuccess:$t,CartProcessesDecrement:Rt,CartProcessesIncrement:oe,CartRemoveEntry:Vt,CartRemoveEntryFail:Lt,CartRemoveEntrySuccess:_t,CartRemoveVoucher:kt,CartRemoveVoucherFail:Yt,CartRemoveVoucherSuccess:Bt,CartResetAddVoucher:Nt,CartUpdateEntry:Pt,CartUpdateEntryFail:bt,CartUpdateEntrySuccess:Gt,ClearCartState:de,CreateCart:St,CreateCartFail:Qt,CreateCartSuccess:Xt,DELETE_CART:X,DELETE_CART_FAIL:gt,DELETE_CART_SUCCESS:K,DeleteCart:se,DeleteCartFail:ae,DeleteCartSuccess:ie,LOAD_CART:$,LOAD_CARTS_SUCCESS:ht,LOAD_CART_FAIL:zt,LOAD_CART_SUCCESS:_,LoadCart:R,LoadCartFail:It,LoadCartSuccess:Zt,LoadCartsSuccess:class Xe extends n.kPG.EntitySuccessAction{constructor(s){super(v,s.map(t=>t?.code??"")),this.payload=s,this.type=ht}},MERGE_CART:vt,MERGE_CART_SUCCESS:pt,MergeCart:te,MergeCartSuccess:ee,REMOVE_CART:Et,RESET_CART_DETAILS:jt,RemoveCart:N,ResetCartDetails:re,SET_ACTIVE_CART_ID:J,SET_CART_DATA:At,SET_CART_TYPE_INDEX:yt,SetActiveCartId:mt,SetCartData:class Ke extends n.kPG.EntitySuccessAction{constructor(s){super(v,s.cartId),this.payload=s,this.type=At}},SetCartTypeIndex:D});class ue{}let Ce=(()=>{class e{constructor(t){this.adapter=t}add(t,i,r,a,o){return this.adapter.add(t,i,r,a,o)}update(t,i,r,a,o,p=!1){return this.adapter.update(t,i,r,a,o,p)}remove(t,i,r){return this.adapter.remove(t,i,r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(ue))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),qe=(()=>{class e{constructor(t,i){this.actions$=t,this.cartEntryConnector=i,this.contextChange$=this.actions$.pipe((0,C.l4)(n.dO9.CURRENCY_CHANGE,n.dO9.LANGUAGE_CHANGE)),this.logger=(0,c.f3M)(n.mQy),this.addEntry$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(Y),(0,u.U)(r=>r.payload),(0,I.b)(r=>this.cartEntryConnector.add(r.userId,r.cartId,r.productCode,r.quantity,r.pickupStore).pipe((0,u.U)(a=>new ct({...r,...a})),(0,g.K)(a=>(0,F.D)([new ot({...r,error:(0,n.cxH)(a,this.logger)}),new R({cartId:r.cartId,userId:r.userId})])))),(0,n.FM_)(this.contextChange$))),this.removeEntry$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(rt),(0,u.U)(r=>r.payload),(0,I.b)(r=>this.cartEntryConnector.remove(r.userId,r.cartId,r.entryNumber).pipe((0,u.U)(()=>new _t({...r})),(0,g.K)(a=>(0,F.D)([new Lt({...r,error:(0,n.cxH)(a,this.logger)}),new R({cartId:r.cartId,userId:r.userId})])))),(0,n.FM_)(this.contextChange$))),this.updateEntry$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(it),(0,u.U)(r=>r.payload),(0,I.b)(r=>this.cartEntryConnector.update(r.userId,r.cartId,r.entryNumber,r.quantity,r.pickupStore,r.pickupToDelivery).pipe((0,u.U)(()=>new Gt({...r})),(0,g.K)(a=>(0,F.D)([new bt({...r,error:(0,n.cxH)(a,this.logger)}),new R({cartId:r.cartId,userId:r.userId})])))),(0,n.FM_)(this.contextChange$)))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(C.eX),c.LFG(Ce))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();class he{}let le=(()=>{class e{constructor(t){this.adapter=t}add(t,i,r){return this.adapter.add(t,i,r)}remove(t,i,r){return this.adapter.remove(t,i,r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(he))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Ze=(()=>{class e{constructor(t,i,r){this.actions$=t,this.cartVoucherConnector=i,this.messageService=r,this.logger=(0,c.f3M)(n.mQy),this.addCartVoucher$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(O),(0,u.U)(a=>a.payload),(0,y.zg)(a=>this.cartVoucherConnector.add(a.userId,a.cartId,a.voucherId).pipe((0,u.U)(()=>(this.showGlobalMessage("voucher.applyVoucherSuccess",a.voucherId,n.xUg.MSG_TYPE_CONFIRMATION),new $t({...a}))),(0,g.K)(o=>(0,F.D)([new Ot({...a,error:(0,n.cxH)(o,this.logger)}),new Rt(a.cartId),new R({userId:a.userId,cartId:a.cartId})])))))),this.removeCartVoucher$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(j),(0,u.U)(a=>a.payload),(0,y.zg)(a=>this.cartVoucherConnector.remove(a.userId,a.cartId,a.voucherId).pipe((0,u.U)(()=>(this.showGlobalMessage("voucher.removeVoucherSuccess",a.voucherId,n.xUg.MSG_TYPE_INFO),new Bt({userId:a.userId,cartId:a.cartId,voucherId:a.voucherId}))),(0,g.K)(o=>(0,F.D)([new Yt({error:(0,n.cxH)(o,this.logger),cartId:a.cartId,userId:a.userId,voucherId:a.voucherId}),new R({userId:a.userId,cartId:a.cartId})]))))))}showGlobalMessage(t,i,r){this.messageService.add({key:t,params:{voucherCode:i}},r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(C.eX),c.LFG(le),c.LFG(n.IWp))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();function U(e,s){return s===n.Fds?e?.guid??"":e?.code??""}function Tt(e=""){return e.startsWith("selectivecart")}function ve(e){return"notFound"===e.reason&&"cart"===e.subjectType&&!Tt(e.subject)}function rr(e){return"VoucherOperationError"===e.type}function sr(e){return"CartError"===e.type||"CartAddressError"===e.type||"CartEntryError"===e.type||"CartEntryGroupError"===e.type}function pe(e){return e.startsWith("temp-")}function b(e){return!e||"object"==typeof e&&0===Object.keys(e).length}const q=(0,l.ZF)("cart"),x=(0,l.P1)(q,e=>e.carts),Ee=e=>(0,l.P1)(x,s=>n.kPG.entityProcessesLoaderStateSelector(s,e)),Ft=e=>(0,l.P1)(x,s=>n.kPG.entityValueSelector(s,e)),ge=e=>(0,l.P1)(x,s=>n.kPG.entityIsStableSelector(s,e)),Se=e=>(0,l.P1)(x,s=>n.kPG.entityHasPendingProcessesSelector(s,e)),Z=e=>(0,l.P1)(Ft(e),s=>s&&s.entries?s.entries:[]),Ie=(e,s)=>(0,l.P1)(Z(e),t=>t.find(i=>i.product?.code===s)),fe=(0,l.P1)(x,e=>Object.keys(e.entities).map(s=>n.kPG.entityValueSelector(e,s))),ye=(0,l.P1)(q,e=>e.index),Ae=e=>(0,l.P1)(ye,s=>s&&s[e]);class Re{}let Mt=(()=>{class e{constructor(t){this.adapter=t}loadAll(t){return this.adapter.loadAll(t)}load(t,i){return this.adapter.load(t,i)}create(t,i,r){return this.adapter.create(t,i,r)}delete(t,i){return this.adapter.delete(t,i)}save(t,i,r,a){return this.adapter.save(t,i,r,a)}addEmail(t,i,r){return this.adapter.addEmail(t,i,r)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(Re))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),nr=(()=>{class e{handleLoadCartError(t,i){if(i?.error?.errors){if(i.error.errors.filter(o=>"invalid"===o.reason).length>0)return(0,M.of)(new R({...t}));if(i.error.errors.filter(o=>ve(o)||"UnknownResourceError"===o.reason).length>0)return(0,M.of)(new N({cartId:t.cartId}))}return(0,M.of)(new It({...t,error:(0,n.cxH)(i,this.logger)}))}constructor(t,i,r){this.actions$=t,this.cartConnector=i,this.store=r,this.contextChange$=this.actions$.pipe((0,C.l4)(n.dO9.CURRENCY_CHANGE,n.dO9.LANGUAGE_CHANGE)),this.logger=(0,c.f3M)(n.mQy),this.loadCart$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)($),(0,u.U)(a=>a.payload),(0,we.v)(a=>a.cartId),(0,y.zg)(a=>a.pipe((0,S.w)(o=>(0,M.of)(o).pipe((0,f.M)(this.store.pipe((0,l.Ys)(Se(o.cartId)))))),(0,E.h)(([o,p])=>!p),(0,u.U)(([o])=>o),(0,S.w)(o=>this.cartConnector.load(o.userId,o.cartId).pipe((0,y.zg)(p=>{let T=[];return p?(T.push(new Zt({...o,cart:p,cartId:U(p,o.userId)})),o.cartId===n.gSv&&T.push(new N({cartId:n.gSv}))):T=[new It({...o,error:{}})],T}),(0,g.K)(p=>this.handleLoadCartError(o,p)))))),(0,n.FM_)(this.contextChange$))),this.createCart$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(P),(0,u.U)(a=>a.payload),(0,y.zg)(a=>this.cartConnector.create(a.userId,a.oldCartId,a.toMergeCartGuid).pipe((0,S.w)(o=>{const p=[];return a.oldCartId&&p.push(new ee({extraData:a.extraData,userId:a.userId,tempCartId:a.tempCartId,cartId:U(o,a.userId),oldCartId:a.oldCartId})),[new Xt({...a,cart:o,cartId:U(o,a.userId)}),new N({cartId:a.tempCartId}),...p]}),(0,g.K)(o=>(0,M.of)(new Qt({...a,error:(0,n.cxH)(o,this.logger)}))))),(0,n.FM_)(this.contextChange$))),this.mergeCart$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(vt),(0,u.U)(a=>a.payload),(0,S.w)(a=>this.cartConnector.load(a.userId,n.gSv).pipe((0,u.U)(o=>{if(o?.code!==a.cartId)return new St({userId:a.userId,oldCartId:a.cartId,toMergeCartGuid:o?o.guid:void 0,extraData:a.extraData,tempCartId:a.tempCartId})}),(0,E.h)(n.pTN))),(0,n.FM_)(this.contextChange$))),this.refresh$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(W),(0,u.U)(a=>a.payload),(0,I.b)(a=>(0,F.D)([new Rt(a.cartId),new R({userId:a.userId,cartId:a.cartId})])))),this.refreshWithoutProcesses$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(w,z,H,Q),(0,u.U)(a=>a.payload),(0,u.U)(a=>new R({userId:a.userId,cartId:a.cartId})))),this.resetCartDetailsOnSiteContextChange$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(n.dO9.LANGUAGE_CHANGE,n.dO9.CURRENCY_CHANGE),(0,y.zg)(()=>[new re]))),this.addEmail$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(lt),(0,u.U)(a=>a.payload),(0,y.zg)(a=>this.cartConnector.addEmail(a.userId,a.cartId,a.email).pipe((0,y.zg)(()=>[new qt({...a}),new R({userId:a.userId,cartId:a.cartId})]),(0,g.K)(o=>(0,F.D)([new Jt({...a,error:(0,n.cxH)(o,this.logger)}),new R({userId:a.userId,cartId:a.cartId})])))),(0,n.FM_)(this.contextChange$))),this.deleteCart$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(X),(0,u.U)(a=>a.payload),(0,y.zg)(a=>this.cartConnector.delete(a.userId,a.cartId).pipe((0,u.U)(()=>new ie({...a})),(0,g.K)(o=>(0,F.D)([new ae({...a,error:(0,n.cxH)(o,this.logger)}),new R({...a})]))))))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(C.eX),c.LFG(Mt),c.LFG(l.yh))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),me=(()=>{class e{getActiveCartTypeOnLoadSuccess(t){if(t?.payload?.extraData?.active)return new D(t.payload?.cart.saveTime?{cartType:d.EI.ACTIVE,cartId:""}:{cartType:d.EI.ACTIVE,cartId:t.meta.entityId})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();const cr=[qe,Ze,nr,(()=>{class e{getActiveCartTypeOnLoad(t){if(t?.payload?.cartId===n.gSv)return new D({cartType:d.EI.ACTIVE,cartId:""})}getActiveCartTypeOnLoadSuccess(t){return this.multiCartEffectsService.getActiveCartTypeOnLoadSuccess(t)}getActiveCartTypeOnCreate(t){if(t?.payload?.extraData?.active)return new D({cartType:d.EI.ACTIVE,cartId:t.meta.entityId})}constructor(t,i){this.actions$=t,this.multiCartEffectsService=i,this.processesIncrement$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(O),(0,u.U)(r=>r.payload),(0,u.U)(r=>new oe(r.cartId)))),this.setSelectiveId$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(_),(0,u.U)(r=>{switch(r.type){case _:{const a=r.payload;if(Tt(a.cartId))return new D({cartType:d.EI.SELECTIVE,cartId:a.cartId});break}}}),(0,E.h)(n.pTN))),this.setActiveCartId$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(_,$,G,P,J),(0,u.U)(r=>{switch(r.type){case $:return this.getActiveCartTypeOnLoad(r);case _:return this.getActiveCartTypeOnLoadSuccess(r);case P:return this.getActiveCartTypeOnCreate(r);case G:return new D({cartType:r?.payload?.extraData?.active?d.EI.ACTIVE:d.EI.NEW_CREATED,cartId:r.meta.entityId});case J:return new D({cartType:d.EI.ACTIVE,cartId:r.payload})}}),(0,E.h)(n.pTN)))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(C.eX),c.LFG(me))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})()],Te={[d.EI.ACTIVE]:""};function or(e=Te,s){switch(s.type){case yt:return{...e,[s.payload.cartType]:s.payload.cartId};case Et:case K:return s.payload?.cartId===e[d.EI.ACTIVE]?{...e,[d.EI.ACTIVE]:""}:e;case ft:return Te}return e}const dr=void 0;function ur(e=dr,s){switch(s.type){case ht:return s.payload;case _:case G:case At:return s.payload.cart}return e}const hr=[function Cr(e){return function(s,t){return t.type===n.uQL.LOGOUT&&(s=void 0),e(s,t)}}],Fe=new c.OlP("MultiCartReducers"),vr={provide:Fe,useFactory:function lr(){return{carts:n.kPG.entityProcessesLoaderReducer(v,ur),index:or}}};var pr=Object.freeze({__proto__:null,getCartEntitySelectorFactory:Ee,getCartEntriesSelectorFactory:Z,getCartEntrySelectorFactory:Ie,getCartHasPendingProcessesSelectorFactory:Se,getCartIdByTypeFactory:Ae,getCartIsStableSelectorFactory:ge,getCartSelectorFactory:Ft,getCartTypeIndex:ye,getCartsSelectorFactory:fe,getMultiCartEntities:x,getMultiCartState:q});let Er=(()=>{class e{constructor(t,i,r){this.statePersistenceService=t,this.store=i,this.siteContextParamsService=r,this.subscription=new et.w}initSync(){this.subscription.add(this.statePersistenceService.syncWithStorage({key:"cart",state$:this.getCartState(),context$:this.siteContextParamsService.getValues([n.iEg]),storageType:n.iHd.LOCAL_STORAGE,onRead:t=>this.onRead(t)}))}getCartState(){return this.store.pipe((0,E.h)(t=>!!t.cart),(0,l.Ys)(q),(0,E.h)(t=>!!t),(0,u.U)(t=>t.index),function Oe(e,s){return(0,m.x)((t,i)=>s?s(t[e],i[e]):t[e]===i[e])}("Active"),(0,u.U)(t=>({active:t[d.EI.ACTIVE]??""})))}onRead(t){this.store.dispatch(new de),this.store.dispatch(new mt(t?t.active:""))}ngOnDestroy(){this.subscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(n.WBb),c.LFG(l.yh),c.LFG(n.Qnj))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function gr(e,s){return()=>s.getStable("context").pipe((0,L.b)(()=>{e.initSync()})).toPromise()}function Sr(){return s=>(t,i)=>{const r={...t};return"@ngrx/store/init"===i.type&&(r.cart={...r.cart,index:{[d.EI.ACTIVE]:void 0}}),s(r,i)}}let Ir=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[{provide:n.z4I,useFactory:gr,deps:[Er,n.yUt],multi:!0},{provide:l.sr,useFactory:Sr,multi:!0}]}),e})();class Me{}let De=(()=>{class e{constructor(t){this.adapter=t}validate(t,i){return this.adapter.validate(t,i)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(Me))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),fr=(()=>{class e{constructor(t,i,r,a){this.actionsSubject=t,this.event=i,this.activeCartService=r,this.stateEventService=a,this.register()}register(){this.registerCreateCart(),this.registerAddEntry(),this.registerRemoveEntry(),this.registerUpdateEntry(),this.registerDeleteCart(),this.registerAddCartVoucher(),this.registerRemoveCartVoucher(),this.registerMergeCartSuccess()}registerAddEntry(){this.registerMapped({action:Y,event:d.uP}),this.registerMapped({action:w,event:d.VD}),this.registerMapped({action:B,event:d.K$})}registerRemoveEntry(){this.registerMapped({action:z,event:d.A7}),this.registerMapped({action:st,event:d.dC})}registerUpdateEntry(){this.registerMapped({action:H,event:d.X}),this.registerMapped({action:at,event:d.gI})}registerMergeCartSuccess(){this.registerMapped({action:pt,event:d.pA})}registerCreateCart(){this.stateEventService.register({action:P,event:d.su}),this.stateEventService.register({action:G,event:d.cA}),this.stateEventService.register({action:Ct,event:d.Cj})}registerDeleteCart(){this.stateEventService.register({action:X,event:d.aY,factory:t=>(0,n.PjU)(d.aY,{...t.payload,cartCode:t.payload.cartId})}),this.stateEventService.register({action:K,event:d.N0,factory:t=>(0,n.PjU)(d.N0,{...t.payload,cartCode:t.payload.cartId})}),this.stateEventService.register({action:gt,event:d.Ks,factory:t=>(0,n.PjU)(d.Ks,{...t.payload,cartCode:t.payload.cartId})})}registerAddCartVoucher(){this.stateEventService.register({action:O,event:d.aT}),this.stateEventService.register({action:W,event:d.Es}),this.stateEventService.register({action:dt,event:d.re})}registerRemoveCartVoucher(){this.stateEventService.register({action:j,event:d.uX}),this.stateEventService.register({action:Q,event:d.FC}),this.stateEventService.register({action:ut,event:d.kd})}registerMapped(t){const i=this.getAction(t.action).pipe((0,S.w)(r=>(0,M.of)(r).pipe((0,f.M)(this.activeCartService.getActive(),this.activeCartService.getActiveCartId()))),(0,E.h)(([r,a,o])=>r.payload.cartId===o),(0,u.U)(([r,a])=>(0,n.PjU)(t.event,{...r.payload,cartCode:a.code,entry:r.payload.entry?r.payload.entry:a.entries?.[Number(r.payload.entryNumber)]})));return this.event.register(t.event,i)}getAction(t){return this.actionsSubject.pipe((0,C.l4)(...[].concat(t)))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(l.UO),c.LFG(n.POd),c.LFG(d.bu),c.LFG(n.vL$))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),yr=(()=>{class e{constructor(t){}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(fr))},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({}),e})(),Ar=(()=>{class e{constructor(t){this.eventService=t,this.register()}register(){this.eventService.register(d.uB,this.buildCartPageEvent())}buildCartPageEvent(){return this.eventService.get(He.z4w).pipe((0,E.h)(t=>"cart"===t.semanticRoute),(0,u.U)(t=>(0,n.PjU)(d.uB,{navigation:t})))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(n.POd))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Rr=(()=>{class e{constructor(t){}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(Ar))},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({}),e})(),Ue=(()=>{class e{constructor(t,i,r){this.multiCartFacade=t,this.userIdService=i,this.winRef=r,this.subscription=new et.w,this.activeCartId$=this.userIdService.getUserId().pipe((0,A.q)(1),(0,S.w)(()=>this.multiCartFacade.getCartIdByType(d.EI.ACTIVE)),(0,E.h)(a=>void 0!==a),(0,u.U)(a=>""===a?n.gSv:a)),this.cartEntity$=this.activeCartId$.pipe((0,S.w)(a=>this.multiCartFacade.getCartEntity(a))),this.shouldLoadCartOnCodeFlow=!0,this.checkInitLoad=void 0,this.initActiveCart(),this.detectUserChange()}initActiveCart(){const t=this.cartEntity$.pipe((0,u.U)(r=>({cart:r.value,isStable:!r.loading&&0===r.processesCount,loaded:Boolean((r.error||r.success)&&!r.loading)})),(0,E.h)(({isStable:r,cart:a})=>r||b(a))),i=t.pipe((0,f.M)(this.activeCartId$,this.userIdService.getUserId()),(0,L.b)(([{cart:r,loaded:a,isStable:o},p,T])=>{o&&b(r)&&!a&&!pe(p)&&this.shouldLoadCartOnCodeFlow&&this.load(p,T)}));this.activeCart$=(0,ke.g)(()=>i.subscribe(),()=>t).pipe((0,u.U)(({cart:r})=>r||{}),(0,m.x)(),(0,Dt.d)({bufferSize:1,refCount:!0}))}detectUserChange(){this.subscription.add(this.userIdService.getUserId().pipe((0,$e.G)(),(0,f.M)(this.activeCartId$)).subscribe(([[t,i],r])=>{(function ar(e,s){return e!==n.Fds&&s!==e})(i,t)&&this.loadOrMerge(r,i,t)})),this.isLoggedInWithCodeFlow()&&(this.shouldLoadCartOnCodeFlow=!1,this.subscription.add(this.userIdService.getUserId().pipe((0,f.M)(this.activeCartId$)).subscribe(([t,i])=>{this.loadOrMerge(i,t,n.Fds),this.winRef?.localStorage?.removeItem(n.VXE)})))}getActive(){return this.activeCart$}takeActive(){return this.isStable().pipe((0,E.h)(t=>t),(0,S.w)(()=>this.getActive()),(0,E.h)(t=>!!t),(0,A.q)(1))}getActiveCartId(){return this.activeCart$.pipe((0,f.M)(this.userIdService.getUserId()),(0,u.U)(([t,i])=>U(t,i)),(0,m.x)())}takeActiveCartId(){return this.isStable().pipe((0,E.h)(t=>t),(0,S.w)(()=>this.getActiveCartId()),(0,E.h)(t=>!!t),(0,A.q)(1))}getEntries(){return this.activeCartId$.pipe((0,S.w)(t=>this.multiCartFacade.getEntries(t)),(0,m.x)())}getLastEntry(t){return this.activeCartId$.pipe((0,S.w)(i=>this.multiCartFacade.getLastEntry(i,t)),(0,m.x)())}getLoading(){return this.cartEntity$.pipe((0,u.U)(t=>Boolean(t.loading)),(0,m.x)())}isStable(){return this.activeCartId$.pipe((0,S.w)(t=>this.multiCartFacade.isStable(t)))}load(t,i){i===n.Fds&&t===n.gSv||this.multiCartFacade.loadCart({userId:i,cartId:t,extraData:{active:!0}})}loadOrMerge(t,i,r){t===n.gSv||r!==n.Fds?this.multiCartFacade.loadCart({userId:i,cartId:t,extraData:{active:!0}}):Boolean((0,n.P51)(this.isGuestCart()))?this.guestCartMerge(t):this.multiCartFacade.mergeToCurrentCart({userId:i,cartId:t,extraData:{active:!0}})}guestCartMerge(t){this.getEntries().pipe((0,A.q)(1)).subscribe(i=>{this.multiCartFacade.deleteCart(t,n.Fds),this.addEntriesGuestMerge(i)})}addEntriesGuestMerge(t){const i=t.map(r=>({productCode:r.product?.code??"",quantity:r.quantity??0}));this.requireLoadedCart(!0).pipe((0,f.M)(this.userIdService.getUserId())).subscribe(([r,a])=>{this.multiCartFacade.addEntries(a,U(r,a),i)})}isCartCreating(t,i){return pe(i)&&(t.loading||t.success||t.error)}isLoggedInWithCodeFlow(){return!!this.winRef?.localStorage?.getItem(n.VXE)}requireLoadedCart(t=!1){this.checkInitLoad=void 0===this.checkInitLoad;const i=(t?this.cartEntity$.pipe((0,E.h)(()=>!Boolean((0,n.P51)(this.isGuestCart())))):this.cartEntity$).pipe((0,E.h)(r=>!r.loading||!!this.checkInitLoad));return this.activeCartId$.pipe((0,f.M)(i),(0,E.h)(([r,a])=>!this.isCartCreating(a,r)),(0,u.U)(([,r])=>r),(0,A.q)(1)).pipe((0,f.M)(this.userIdService.getUserId()),(0,L.b)(([r,a])=>{b(r.value)&&a!==n.Fds&&!r.loading&&this.load(n.gSv,a),this.checkInitLoad=!1}),(0,S.w)(()=>i),(0,f.M)(this.userIdService.getUserId()),(0,E.h)(([r,a])=>Boolean(a===n.Fds||r.success||r.error)),(0,A.q)(1)).pipe((0,L.b)(([r,a])=>{b(r.value)&&this.multiCartFacade.createCart({userId:a,extraData:{active:!0}})}),(0,S.w)(()=>i),(0,E.h)(r=>Boolean(r.success||r.error)),(0,f.M)(this.activeCartId$),(0,E.h)(([r,a])=>!this.isCartCreating(r,a)),(0,u.U)(([r])=>r.value),(0,E.h)(r=>!b(r)),(0,A.q)(1))}addEntry(t,i,r){this.requireLoadedCart().pipe((0,f.M)(this.userIdService.getUserId())).subscribe(([a,o])=>{this.multiCartFacade.addEntry(o,U(a,o),t,i,r)})}removeEntry(t){this.activeCartId$.pipe((0,f.M)(this.userIdService.getUserId()),(0,A.q)(1)).subscribe(([i,r])=>{this.multiCartFacade.removeEntry(r,i,t.entryNumber)})}updateEntry(t,i,r,a=!1){this.activeCartId$.pipe((0,f.M)(this.userIdService.getUserId()),(0,A.q)(1)).subscribe(([o,p])=>{this.multiCartFacade.updateEntry(p,o,t,i,r,a)})}getEntry(t){return this.activeCartId$.pipe((0,S.w)(i=>this.multiCartFacade.getEntry(i,t)),(0,m.x)())}addEmail(t){this.activeCartId$.pipe((0,f.M)(this.userIdService.getUserId()),(0,A.q)(1)).subscribe(([i,r])=>{this.multiCartFacade.assignEmail(i,r,t)})}getAssignedUser(){return this.activeCart$.pipe((0,u.U)(t=>t.user))}isGuestCart(t){return t?(0,M.of)(this.isCartUserGuest(t)):this.activeCart$.pipe((0,u.U)(i=>this.isCartUserGuest(i)),(0,m.x)())}isCartUserGuest(t){const i=t.user;return Boolean(i&&(i.name===n.YI5||function ir(e){return!!e&&!!e.match(n.QIJ)}(i.uid?.split("|").slice(1).join("|"))))}addEntries(t){const i=t.map(r=>({productCode:r.product?.code??"",quantity:r.quantity??0}));this.requireLoadedCart().pipe((0,f.M)(this.userIdService.getUserId())).subscribe(([r,a])=>{r&&this.multiCartFacade.addEntries(a,U(r,a),i)})}reloadActiveCart(){(0,k.aj)([this.getActiveCartId(),this.userIdService.takeUserId()]).pipe((0,A.q)(1),(0,u.U)(([t,i])=>{this.multiCartFacade.loadCart({cartId:t,userId:i,extraData:{active:!0}})})).subscribe()}hasPickupItems(){return this.getActive().pipe((0,u.U)(t=>!!t.pickupItemsQuantity&&t.pickupItemsQuantity>0))}hasDeliveryItems(){return this.getActive().pipe((0,u.U)(t=>!!t.deliveryItemsQuantity&&t.deliveryItemsQuantity>0))}getPickupEntries(){return this.getEntries().pipe((0,u.U)(t=>t.filter(i=>void 0!==i.deliveryPointOfService)))}getDeliveryEntries(){return this.getEntries().pipe((0,u.U)(t=>t.filter(i=>void 0===i.deliveryPointOfService)))}ngOnDestroy(){this.subscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(d.WT),c.LFG(n.XBV),c.LFG(n.X9E,8))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),Ve=(()=>{class e{constructor(t){this.routingService=t,this.NAVIGATION_SKIPS=2,this.navigationIdCount=0,this.subscription=new et.w,this.cartValidationResult$=new Ye.t(1),this.checkForValidationResultClear$=this.routingService.getRouterState().pipe((0,f.M)(this.cartValidationResult$),(0,L.b)(([i,r])=>{this.navigationIdCount+this.NAVIGATION_SKIPS<=i.navigationId&&r.length&&(this.cartValidationResult$.next([]),this.navigationIdCount=i.navigationId)})),this.setInitialState()}ngOnDestroy(){this.subscription.unsubscribe()}setInitialState(){this.setNavigationIdStep(),this.subscription.add(this.checkForValidationResultClear$.subscribe())}updateValidationResultAndRoutingId(t){this.cartValidationResult$.next(t),this.setNavigationIdStep()}setNavigationIdStep(){this.routingService.getRouterState().pipe((0,A.q)(1)).subscribe(t=>this.navigationIdCount=t.navigationId)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(n.Znh))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),_e=(()=>{class e{constructor(t,i,r,a,o){this.cartValidationConnector=t,this.command=i,this.userIdService=r,this.activeCartFacade=a,this.cartValidationStateService=o,this.validateCartCommand=this.command.create(()=>(0,k.aj)([this.activeCartFacade.getActiveCartId(),this.userIdService.takeUserId(),this.activeCartFacade.isStable()]).pipe((0,E.h)(([p,T,Lr])=>Lr),(0,A.q)(1),(0,S.w)(([p,T])=>this.cartValidationConnector.validate(p,T))),{strategy:n.flE.CancelPrevious})}validateCart(){return this.validateCartCommand.execute()}getValidationResults(){return this.cartValidationStateService.cartValidationResult$}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(De),c.LFG(n.VDr),c.LFG(n.XBV),c.LFG(d.bu),c.LFG(Ve))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),Le=(()=>{class e{constructor(t,i,r){this.store=t,this.activeCartFacade=i,this.userIdService=r}addVoucher(t,i){this.combineUserAndCartId(i).subscribe(([r,a])=>this.store.dispatch(new wt({userId:r,cartId:a,voucherId:t})))}removeVoucher(t,i){this.combineUserAndCartId(i).subscribe(([r,a])=>this.store.dispatch(new kt({userId:r,cartId:a,voucherId:t})))}getAddVoucherResultError(){return this.store.pipe((0,l.Ys)(n.VkE.getProcessErrorFactory(V)))}getAddVoucherResultSuccess(){return this.store.pipe((0,l.Ys)(n.VkE.getProcessSuccessFactory(V)))}getAddVoucherResultLoading(){return this.store.pipe((0,l.Ys)(n.VkE.getProcessLoadingFactory(V)))}resetAddVoucherProcessingState(){this.store.dispatch(new Nt)}combineUserAndCartId(t){return t?this.userIdService.getUserId().pipe((0,A.q)(1),(0,u.U)(i=>[i,t])):(0,k.aj)([this.userIdService.getUserId(),this.activeCartFacade.getActiveCartId()]).pipe((0,A.q)(1))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(l.yh),c.LFG(d.bu),c.LFG(n.XBV))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),Pe=(()=>{class e{constructor(t,i){this.store=t,this.userIdService=i}getCart(t){return this.store.pipe((0,l.Ys)(Ft(t)))}getCarts(){return this.store.pipe((0,l.Ys)(fe))}getCartEntity(t){return this.store.pipe((0,l.Ys)(Ee(t)))}isStable(t){return this.store.pipe((0,l.Ys)(ge(t)),(0,Ne.D)(i=>i?(0,Be.H)(0):ze.E),(0,m.x)())}generateTempCartId(){return`temp-${Math.random().toString(36).substring(2,11)}`}createCart({userId:t,oldCartId:i,toMergeCartGuid:r,extraData:a}){const o=this.generateTempCartId();return this.store.dispatch(new St({extraData:a,userId:t,oldCartId:i,toMergeCartGuid:r,tempCartId:o})),this.getCartIdByType(a?.active?d.EI.ACTIVE:d.EI.NEW_CREATED).pipe((0,S.w)(p=>this.getCart(p)),(0,E.h)(n.pTN))}mergeToCurrentCart({userId:t,cartId:i,extraData:r}){const a=this.generateTempCartId();this.store.dispatch(new te({userId:t,cartId:i,extraData:r,tempCartId:a}))}loadCart({cartId:t,userId:i,extraData:r}){this.store.dispatch(new R({userId:i,cartId:t,extraData:r}))}getEntries(t){return this.store.pipe((0,l.Ys)(Z(t)))}getLastEntry(t,i){return this.store.pipe((0,l.Ys)(Z(t)),(0,u.U)(r=>{const a=r.filter(o=>o.product?.code===i);return a?a[a.length-1]:void 0}))}addEntry(t,i,r,a,o){this.store.dispatch(new nt({userId:t,cartId:i,productCode:r,quantity:a,pickupStore:o}))}addEntries(t,i,r){r.forEach(a=>{this.store.dispatch(new nt({userId:t,cartId:i,productCode:a.productCode,quantity:a.quantity}))})}removeEntry(t,i,r){this.store.dispatch(new Vt({userId:t,cartId:i,entryNumber:`${r}`}))}updateEntry(t,i,r,a,o,p=!1){void 0!==a&&a<=0?this.removeEntry(t,i,r):this.store.dispatch(new Pt({userId:t,cartId:i,pickupStore:o,pickupToDelivery:p,entryNumber:`${r}`,quantity:a}))}getEntry(t,i){return this.store.pipe((0,l.Ys)(Ie(t,i)))}assignEmail(t,i,r){this.store.dispatch(new Kt({userId:i,cartId:t,email:r}))}removeCart(t){this.store.dispatch(new N({cartId:t}))}deleteCart(t,i){this.store.dispatch(new se({userId:i,cartId:t}))}reloadCart(t,i){this.userIdService.takeUserId().subscribe(r=>this.store.dispatch(new R({userId:r,cartId:t,extraData:i})))}getCartIdByType(t){return this.store.pipe((0,l.Ys)(Ae(t)),(0,m.x)())}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(l.yh),c.LFG(n.XBV))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})(),Ge=(()=>{class e{constructor(t,i,r,a){this.userProfileFacade=t,this.multiCartFacade=i,this.baseSiteService=r,this.userIdService=a}getCart(){return this.selectiveCart$||(this.selectiveCart$=(0,k.aj)([this.getSelectiveCartId(),this.userProfileFacade.get(),this.userIdService.getUserId(),this.baseSiteService.getActive()]).pipe((0,m.x)(),(0,L.b)(([t,i,r,a])=>{!Boolean(t)&&r!==n.Fds&&i?.customerId&&this.multiCartFacade.loadCart({userId:r,cartId:`selectivecart${a}${i.customerId}`})}),(0,E.h)(([t])=>Boolean(t)),(0,S.w)(([t])=>this.multiCartFacade.getCart(t)),(0,Dt.d)({bufferSize:1,refCount:!0}))),this.selectiveCart$}getEntries(){return this.getSelectiveCartId().pipe((0,S.w)(t=>this.multiCartFacade.getEntries(t)))}isStable(){return this.getSelectiveCartId().pipe((0,S.w)(t=>this.multiCartFacade.isStable(t)))}addEntry(t,i){this.getSelectiveIdWithUserId().subscribe(([r,a])=>{this.multiCartFacade.addEntry(a,r,t,i)})}removeEntry(t){this.getSelectiveIdWithUserId().subscribe(([i,r])=>{this.multiCartFacade.removeEntry(r,i,t.entryNumber)})}updateEntry(t,i){this.getSelectiveIdWithUserId().subscribe(([r,a])=>{this.multiCartFacade.updateEntry(a,r,t,i)})}getEntry(t){return this.getSelectiveCartId().pipe((0,S.w)(i=>this.multiCartFacade.getEntry(i,t)))}getSelectiveCartId(){return this.multiCartFacade.getCartIdByType(d.EI.SELECTIVE)}getSelectiveIdWithUserId(){return this.getSelectiveCartId().pipe((0,m.x)(),(0,f.M)(this.userIdService.getUserId()),(0,A.q)(1))}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(We.aT),c.LFG(d.WT),c.LFG(n.Do$),c.LFG(n.XBV))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e})();const mr=[Ue,{provide:d.bu,useExisting:Ue},Le,{provide:d.LN,useExisting:Le},Pe,{provide:d.WT,useExisting:Pe},Ge,{provide:d.Oo,useExisting:Ge},_e,{provide:d.mU,useExisting:_e}];let Tr=(()=>{class e extends n.kck{constructor(){super(...arguments),this.responseStatus=n.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(t){return super.hasMatch(t)&&this.getErrors(t).some(sr)}handleError(t,i){this.handleCartNotFoundError(t,i),this.handleOtherCartErrors(t,i)}handleCartNotFoundError(t,i){this.getErrors(i).filter(r=>ve(r)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.cartNotFound"},n.xUg.MSG_TYPE_ERROR)})}handleOtherCartErrors(t,i){this.getErrors(i).filter(r=>"notFound"!==r.reason||"cart"!==r.subjectType).forEach(r=>{this.globalMessageService.add(r.message?r.message:{key:"httpHandlers.otherCartErrors"},n.xUg.MSG_TYPE_ERROR)})}getErrors(t){return(t.error?.errors||[]).filter(i=>"JaloObjectNoLongerValidError"!==i.type)}}return e.\u0275fac=function(){let s;return function(i){return(s||(s=c.n5z(e)))(i||e)}}(),e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Fr=(()=>{class e extends n.kck{constructor(){super(...arguments),this.responseStatus=n.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(t){return super.hasMatch(t)&&this.getErrors(t).some(rr)}handleError(t,i){this.handleVoucherExceededError(t,i),this.handleVoucherInvalidError(t,i)}handleVoucherExceededError(t,i){this.getErrors(i).filter(r=>function tr(e){return"coupon.already.redeemed"===e.message}(r)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.voucherExceeded"},n.xUg.MSG_TYPE_ERROR)})}handleVoucherInvalidError(t,i){this.getErrors(i).filter(r=>function er(e){return"coupon.invalid.code.provided"===e.message}(r)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.invalidCodeProvided"},n.xUg.MSG_TYPE_ERROR)})}getErrors(t){return(t.error?.errors||[]).filter(i=>"JaloObjectNoLongerValidError"!==i.type)}}return e.\u0275fac=function(){let s;return function(i){return(s||(s=c.n5z(e)))(i||e)}}(),e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Mr=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[vr,me],imports:[je.ez,n.vUS,l.Aw.forFeature("cart",Fe,{metaReducers:hr}),C.sQ.forFeature(cr)]}),e})(),Dr=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[Mt,Ce,le,De,...mr,{provide:n.kck,useExisting:Tr,multi:!0},{provide:n.kck,useExisting:Fr,multi:!0}],imports:[yr,Mr,Ir,Rr]}),e})();const Ur=new c.OlP("CartValidationNormalizer");let be=(()=>{class e{constructor(t){this.config=t}isSelectiveCartEnabled(){return Boolean(this.config?.cart?.selectiveCart?.enabled)}isCartValidationEnabled(){return Boolean(this.config?.cart?.validation?.enabled)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(d.qB))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Vr=(()=>{class e{constructor(t,i,r,a,o,p,T){this.cartValidationService=t,this.semanticPathService=i,this.router=r,this.globalMessageService=a,this.activeCartService=o,this.cartValidationStateService=p,this.cartConfigService=T,this.GLOBAL_MESSAGE_TIMEOUT=1e4}canActivate(){return this.cartConfigService.isCartValidationEnabled()?this.cartValidationService.validateCart().pipe((0,f.M)(this.activeCartService.getEntries()),(0,u.U)(([t,i])=>{if(this.cartValidationStateService.updateValidationResultAndRoutingId(t.cartModifications??[]),void 0!==t.cartModifications&&0!==t.cartModifications.length){let r;const a=t.cartModifications[0];return r=1===i.length&&i[0].product?.code===a.entry?.product?.code&&a.statusCode===d.v$.NO_STOCK?{key:"validation.cartEntryRemoved",params:{name:a.entry?.product?.name}}:{key:"validation.cartEntriesChangeDuringCheckout"},this.globalMessageService.add(r,n.xUg.MSG_TYPE_ERROR,this.GLOBAL_MESSAGE_TIMEOUT),this.activeCartService.reloadActiveCart(),this.router.parseUrl(this.semanticPathService.get("cart")??"")}return!0})):(0,M.of)(!0)}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(d.mU),c.LFG(n.hCH),c.LFG(Qe.F0),c.LFG(n.IWp),c.LFG(d.bu),c.LFG(Ve),c.LFG(be))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),_r=(()=>{class e{constructor(t){this.actionsSubject=t,this.logger=(0,c.f3M)(n.mQy)}getResults(t){return this.actionsSubject.pipe((0,C.l4)(w,B),(0,E.h)(i=>i.payload.cartId===t),(0,u.U)(i=>this.mapMessages(i)))}mapMessages(t){const{productCode:i}=t.payload;if(t instanceof ct){const{quantity:r,quantityAdded:a,entry:o,statusCode:p}=t.payload;if(p===d.QX.LOW_STOCK)return{productCode:i,statusCode:p,productName:o?.product?.name,quantity:r,quantityAdded:a};if(p===d.QX.SUCCESS||p===d.QX.NO_STOCK)return{productCode:i,statusCode:p,productName:o?.product?.name}}else if(t instanceof ot){const{error:r}=t.payload;if("UnknownIdentifierError"===r?.details[0]?.type)return{productCode:i,statusCode:d.QX.UNKNOWN_IDENTIFIER}}return(0,c.X6Q)()&&this.logger.warn("Unrecognized cart add entry action type while mapping messages",t),{productCode:i,statusCode:d.QX.UNKNOWN_ERROR}}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(l.UO))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);